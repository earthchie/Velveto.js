/**
 * @name velveto.min.js
 * @version 2.5.0
 * @update Oct 29, 2016
 * @website https://github.com/earthchie/Velveto.js
 * @author Earthchie http://www.earthchie.com/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
!function(a){"use strict";var c,d,b=a.Velveto||{};a.Velveto=b,b.initialized=!1,b.options={container_id:"velveto",home:"home",html_directory:"app/",debug:!1,loading_indicator:"Loading...",history_max:20},b.ajax={x:[],abortAll:function(){var a;for(a in b.ajax.x)Object.prototype.hasOwnProperty.call(b.ajax.x,a)&&b.ajax.x[a].abort()},xhr:function(){var a;for(a=0;a<4;a+=1)try{return a?new ActiveXObject(["","Msxml2","Msxml3","Microsoft"][a]+".XMLHTTP"):new XMLHttpRequest}catch(a){}},sendRequest:function(a,c,d,e,f){d=d||null;var i,g=new b.ajax.xhr,h="";if("object"==typeof d){for(i in d)Object.prototype.hasOwnProperty.call(d,i)&&(h+="&"+i+"="+d[i]);d=h.substring(1)}g.onreadystatechange=function(){if(4===g.readyState){var a;for(a in b.ajax.x)if(b.ajax.x[a]===g){b.ajax.x.splice(a,1);break}200===g.status?"function"==typeof e&&e(g.responseText):"function"==typeof f&&f(g)}},g.open(a.toString().toUpperCase(),c,!0),g.send(d),b.ajax.x.push(g)},GET:function(a,c,d){a.indexOf("?")>-1?a+="&":a+="?",b.options.debug&&(a+="nonce="+(new Date).getTime()),b.ajax.sendRequest("GET",a,null,c,d)},POST:function(a,c,d){b.ajax.sendRequest("POST",a.url||a,a.data||null,c,d)},executeScript:function(a,b){var c=document.createElement("script");c.setAttribute("data-velveto-script",""),"function"==typeof b&&(c.onload=b),c.src=a,document.head.appendChild(c)}},b.session={get:function(a){return localStorage?localStorage.getItem(a+"@"+b.getBaseURL())||"":void 0===b.tmp?"":b.tmp[a]||""},set:function(a,c){localStorage?localStorage.setItem(a+"@"+b.getBaseURL(),c):(void 0===b.tmp&&(b.tmp=[]),b.tmp[a]=c)},remove:function(a){localStorage?localStorage.removeItem(a+"@"+b.getBaseURL()):void 0!==b.tmp&&delete b.tmp[a]}},b.extend=function(a,b){var d,c={};for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=b[d]);return c},b.importDocument=function(c,e,f){var i,g=e.getAttribute("data-loading-indicator")||b.options.loading_indicator,h=document.querySelectorAll("[data-velveto-script]");for(i=0;i<h.length;i+=1)h[i].parentNode.removeChild(h[i]);b.fireEvent(e,"unload"),e.innerHTML=g,b.fireEvent(e,"beforeLoad"),b.ajax.GET(c,function(c){var j,g=function(){var g,h,c=document.getElementsByTagName("a");for(g=0;g<c.length;g+=1)c[g].href.indexOf(b.getBaseURL())>-1&&c[g].href.indexOf("#!")>-1&&"true"!==c[g].getAttribute("data-ajax")&&c[g].addEventListener("click",function(c){return c.stopPropagation(),c.preventDefault(),this.setAttribute("data-ajax","true"),JSON.stringify(b.getPathData(a.location.hash))!==JSON.stringify(b.getPathData(this.href))&&b.go(this.href),!1}),c[g].href.indexOf("#!")<0&&c[g].href.indexOf("#")>-1&&"false"!==c[g].getAttribute("data-smooth")&&c[g].addEventListener("click",function(a){if(a.preventDefault(),""!==(h=this.href.split("#").pop())){this.setAttribute("data-smooth","true");var c=document.getElementById(h);b.scrollTo(c)}return!1});!1!==history&&d(),"function"==typeof f&&f(),b.fireEvent(e,"loaded")},h=e.getElementsByTagName("script"),i=0;e.innerHTML=c,h.length>0?(j=function(a){if(void 0!==a){var d,c=!1;a.innerHTML&&(d=document.createElement("img"),d.setAttribute("onload","this.parentNode.removeChild(this);"+a.innerHTML),d.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.appendChild(d)),a.src&&(c=!0,b.ajax.executeScript(a.src,function(){i+=1,j(h[i])})),c||(i+=1,j(h[i]))}else b.fireEvent(e,"scriptLoaded"),g()},b.fireEvent(e,"beforeScriptLoad"),j(h[i])):(b.fireEvent(e,"beforeLoadScript"),b.fireEvent(e,"afterLoadScript"),g())},function(){b.options.debug&&console.error("ERROR - fail to import document. URL: "+c+" was not found."),b.fireEvent(e,"loadFail")})},b.iObject=function(a,b,c){var d=function(){return JSON.parse(JSON.stringify(a))},e=function(a,b){for(b=b.replace(/\[(\w+)\]/g,".$1").split(".");b.length>0;)a=a[b.shift()];return a},f=function(a,b,c){var e=d(a),f=function(a,b,c){c||(c=e);var d=a.replace(/\[(\w+)\]/g,".$1").split(/\./);d.length<2?c[d[0]]=b:(c[d[0]]||(c[d[0]]={}),c=c[d.shift()],f(d.join("."),b,c))};return f(b,c),e};return void 0===c?e(a,b):void 0===b?d(a):f(a,b,c)},b.template=function(a,c){"array"==typeof c&&(c=c.reduce(function(a,b,c){return a[c]=b,a},{}));var e,f,d="";if("string"==typeof a&&(d=a),1===a.nodeType&&(d=a.innerHTML),e=(d.match(/\{\{(.*?)\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")})||[],e.map(function(a){f=a.split("||"),f[1]=f[1]||"",d=d.replace(new RegExp("{{"+a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"}}","g"),b.iObject(c,f[0])||f[1])}),"string"==typeof a)return d;1===a.nodeType&&(a.innerHTML=d)},c=function(a,c){b.ajax.abortAll(),setTimeout(function(){var c=document.getElementById(b.options.container_id);c?b.importDocument(b.options.html_directory+a+".html",c):b.options.debug&&console.error("ERROR - Element with id = "+b.options.container_id+" is not found.")},10)},d=function(){var c=b.history();0!==c.length&&c[c.length-1]===a.location.hash||(c.length>=b.options.history_max&&(c=c.slice(-1*(b.options.history_max-1))),c.push(a.location.hash),b.session.set("Velveto",c.join(" || ")))},b.fireEvent=function(a,b){var c;document.createEventNodeList?(c=document.createEventNodeList(),a.fireEvent(b,c)):(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),a.dispatchEvent(c))},b.back=function(){if(b.isBackable()){var a=b.history();a.pop(),b.go(a.pop()),b.session.set("Velveto",a.join(" || "))}},b.goBackOrGoHome=function(){b.isBackable()?b.back():b.go(b.options.home)},b.goBackOrGoTo=function(a){b.isBackable()?b.back():b.go(a)},b.clearHistory=function(){b.session.set("Velveto","")},b.getBaseURL=function(){return a.location.origin+a.location.pathname},b.getPath=function(){return a.location.hash.replace("#!","")},b.getPathData=function(c){var e,g,h,d={},f={};if(c||(c=a.location.hash),c=decodeURI(c.replace(b.getBaseURL(),"").replace("#!","")),c.indexOf("?")>-1?(c=c.split("?"),d.path=c[0],d.params=c[1]):(d.path=c,d.params=""),c=d.path,"/"===c.charAt(0)&&(c=c.substring(1)),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),d.dir=c.split("/"),"/"!==d.path.charAt(0)&&(d.path="/"+d.path),-1===d.path.indexOf(".")?"/"!==d.path.charAt(d.path.length-1)&&(d.path+="/"):"/"===d.path.charAt(d.path.length-1)&&(d.path=d.path.slice(0,-1)),""===d.params)d.params={};else{e=d.params.split("&");for(h in e)Object.prototype.hasOwnProperty.call(e,h)&&(-1===e[h].indexOf("=")?f[e[h]]="":(g=e[h].split("="),f[g[0]]=g[1]));d.params=f}return d},b.data=function(a){var f,c=b.getPathData(a),d=c.params,e=c.dir;e.shift();for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(d[f]=e[f]);return d},b.go=function(a,b,d){var e=this.getPathData(a);!1!==d&&this.setPathData(e.dir,e.params),c(e.dir[0],b)},b.goTo=b.go,b.history=function(){return b.session.get("Velveto")?b.session.get("Velveto").split(" || "):[]},b.isBackable=function(){return b.history().length>2},b.refresh=function(){b.go(a.location.hash,!1,!1)},b.scrollTo=function(b,c){if(null!==b&&"number"==typeof b.offsetTop){void 0===c&&(c=250),b=b.offsetTop;var d=(new Date).getTime(),e=a.scrollY,f=setInterval(function(){var a=Math.min(1,((new Date).getTime()-d)/c);document.body.scrollTop=e+a*(b-e),1===a&&clearInterval(f)},25);document.body.scrollTop=e}},b.setPathData=function(c,d){var h,e="?",f="",g="";if(c&&(f="/"+c.join("/"),-1===f.indexOf(".")&&(f+="/")),d)for(h in d)Object.prototype.hasOwnProperty.call(d,h)&&(d[h]?e+=h+"="+d[h]+"&":e+=h+"&");e=e.slice(0,-1),f&&"//"!==f||(f="",e=e.substring(1)),g="#!"+f+e,a.location.hash+"/"===g?history.replaceState(b.getBaseURL(),"",b.getBaseURL()+g):history.pushState(b.getBaseURL(),"",b.getBaseURL()+g)},b.init=function(c){if(b.initialized)b.options.debug&&console.warn("NOTICE - Velveto is already initiated.");else{if(b.initialized=!0,b.options=b.extend(b.options,c||{}),b.clearHistory(),a.location.origin||(a.location.origin=a.location.protocol+"//"+a.location.hostname+(a.location.port?":"+a.location.port:"")),""===a.location.hash){var d=a.location.href.replace(b.getBaseURL(),"");b.go(b.options.home+d)}else b.go(a.location.hash);a.addEventListener("hashchange",function(c){b.go(a.location.hash)})}}}(window);
