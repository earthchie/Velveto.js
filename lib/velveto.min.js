/**
 * @name velveto.js
 * @version 2.0.1
 * @update September 16, 2014
 * @website http://velveto.project.in.th/
 * @author Earthchie http://www.earthchie.com/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
var Velveto=new function(){var ss=new function(){this.get=function(t){return localStorage?localStorage.getItem(t)||"":""},this.set=function(t,e){localStorage&&localStorage.setItem(t,e)}},aj=new function(){var xhr=[];this.abortAll=function(){for(var t in xhr)xhr[t].abort()},this.x=function(){for(a=0;4>a;a++)try{return a?new ActiveXObject([,"Msxml2","Msxml3","Microsoft"][a]+".XMLHTTP"):new XMLHttpRequest}catch(t){}},this.get=function(t,e,i){var o=new this.x;xhr.push(o),o.open("GET",t,!0),o.send(),o.onreadystatechange=function(){if(4==o.readyState){for(var t in xhr)if(xhr[t]==o){xhr.splice(t,1);break}200==o.status?"function"==typeof e&&e(o.responseText):"function"==typeof i&&i(o)}}},this.getScript=function(url){this.get(url,function(r){eval(r)})}},fireEvent=function(t,e){if(document.createEventNodeList){var i=document.createEventNodeList();t.fireEvent(e,i)}else{var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),t.dispatchEvent(i)}},load=function(filename,history){aj.abortAll();var _this=this;setTimeout(function(){var body=document.getElementById("velveto");if(body){var loading=body.getAttribute("data-loading-indicator");null!=loading&&"false"!=loading&&"0"!=loading&&(body.innerHTML=loading),fireEvent(document.querySelector("#velveto"),"beforeLoad"),aj.get("app/"+filename+".html",function(r){body.innerHTML=r;var scripts=document.querySelectorAll("#velveto script");for(var i in scripts)scripts[i].innerHTML&&eval(scripts[i].innerHTML),scripts[i].src&&aj.getScript(scripts[i].src);for(var a=document.getElementsByTagName("a"),i=0;i<a.length;i++)a[i].href.indexOf(_this.Velveto.getBaseURL())>-1&&a[i].href.indexOf("#!")>-1&&null===a[i].getAttribute("data-ajax")&&(a[i].setAttribute("data-ajax","true"),a[i].addEventListener("click",function(t){t.stopPropagation(),t.preventDefault();var e=JSON.stringify(_this.Velveto.getPathData(window.location.hash)),i=JSON.stringify(_this.Velveto.getPathData(this.href));return e!=i&&_this.Velveto.goTo(this.href),!1})),a[i].href.indexOf("#!")<0&&a[i].href.indexOf("#")>-1&&null===a[i].getAttribute("data-smooth")&&(a[i].setAttribute("data-smooth","true"),a[i].addEventListener("click",function(t){t.preventDefault();var e=document.getElementById(this.href.split("#").pop());return _this.Velveto.scroll(e),!1}));fireEvent(document.querySelector("#velveto"),"loaded"),history!==!1&&pushHistory()},function(){fireEvent(document.querySelector("#velveto"),"loadFail"),_this.Velveto.goTo("home",!1)})}else console.error("Error - Element with id = velveto is not found.")},10)},pushHistory=function(){var t=this.Velveto.history();(0==t.length||t[t.length-1]!=window.location.hash)&&(t.push(window.location.hash),ss.set("Velveto",t.join(" || ")))};this.back=function(){if(this.isBackable()){var t=this.history();t.pop(),this.goTo(t.pop()),ss.set("Velveto",t.join(" || "))}},this.clearHistory=function(){ss.set("Velveto","")},this.getBaseURL=function(){return window.location.origin+window.location.pathname},this.getPath=function(){return window.location.hash.replace("#!","")},this.getPathData=function(t){var e=!1,i={};if(t||(e=!0,t=window.location.hash),t=decodeURI(t.replace(this.getBaseURL(),"").replace("#!","")),t.indexOf("?")>-1?(t=t.split("?"),i.path=t[0],i.params=t[1]):(i.path=t,i.params=""),t=i.path,"/"==t.charAt(0)&&(t=t.substring(1)),"/"==t.charAt(t.length-1)&&(t=t.slice(0,-1)),i.dir=t.split("/"),"/"!=i.path.charAt(0)&&(i.path="/"+i.path),-1==i.path.indexOf(".")?"/"!=i.path.charAt(i.path.length-1)&&(i.path+="/"):"/"==i.path.charAt(i.path.length-1)&&(i.path=i.path.slice(0,-1)),""!=i.params){var o=i.params.split("&"),n={};for(var a in o)if(-1==o[a].indexOf("="))n[o[a]]="";else{var r=o[a].split("=");n[r[0]]=r[1]}i.params=n}return e&&this.setPathData(i.dir,i.params),i},this.goTo=function(t,e){var i=this.getPathData(t);this.setPathData(i.dir,i.params),load(i.dir[0],e)},this.history=function(){return ss.get("Velveto")?ss.get("Velveto").split(" || "):[]},this.isBackable=function(){return this.history().length>2},this.refresh=function(){this.goTo(window.location.hash,!1)},this.scroll=function(t){function e(t,e,i,o,n,a,r){if(t){var s=(new Date).getTime(),h=setInterval(function(){var l=Math.min(1,((new Date).getTime()-s)/a);r?t[e]=o+l*(n-o)+i:t.style[e]=o+l*(n-o)+i,1==l&&clearInterval(h)},25);t.style[e]=o+i}}t&&e(document.body,"scrollTop","",window.scrollY,t.offsetTop,250,!0)},this.setPathData=function(t,e){var i="?",o="";if(t&&(o="/"+t.join("/"),-1==o.indexOf(".")&&(o+="/")),e)for(var n in e)i+=e[n]?n+"="+e[n]+"&":n+"&";i=i.slice(0,-1),o&&"//"!=o||(o="",i=i.substring(1)),history.pushState(this.getBaseURL(),"",this.getBaseURL()+"#!"+o+i)},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),""==window.location.hash?this.goTo("home"):this.goTo(window.location.hash);var _this=this;window.addEventListener("hashchange",function(){_this.goTo(window.location.hash)})};