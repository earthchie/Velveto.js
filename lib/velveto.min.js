/**
 * @name velveto.min.js
 * @version 2.4.1
 * @update Oct 29, 2016
 * @website https://github.com/earthchie/Velveto.js
 * @author Earthchie http://www.earthchie.com/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
 !function(window){"use strict";var Velveto=window.Velveto||{},load,pushHistory;window.Velveto=Velveto,Velveto.initialized=!1,Velveto.options={container_id:"velveto",home:"home",html_directory:"app/",debug:!1,loading_indicator:"Loading...",history_max:20},Velveto.ajax={x:[],abortAll:function(){var a;for(a in Velveto.ajax.x)Object.prototype.hasOwnProperty.call(Velveto.ajax.x,a)&&Velveto.ajax.x[a].abort()},xhr:function(){var a;for(a=0;a<4;a+=1)try{return a?new ActiveXObject(["","Msxml2","Msxml3","Microsoft"][a]+".XMLHTTP"):new XMLHttpRequest}catch(a){}},sendRequest:function(a,b,c,d,e){c=c||null;var h,f=new Velveto.ajax.xhr,g="";if("object"==typeof c){for(h in c)Object.prototype.hasOwnProperty.call(c,h)&&(g+="&"+h+"="+c[h]);c=g.substring(1)}f.onreadystatechange=function(){if(4===f.readyState){var a;for(a in Velveto.ajax.x)if(Velveto.ajax.x[a]===f){Velveto.ajax.x.splice(a,1);break}200===f.status?"function"==typeof d&&d(f.responseText):"function"==typeof e&&e(f)}},f.open(a.toString().toUpperCase(),b,!0),f.send(c),Velveto.ajax.x.push(f)},GET:function(a,b,c){a+=a.indexOf("?")>-1?"&":"?",Velveto.options.debug&&(a+="nonce="+(new Date).getTime()),Velveto.ajax.sendRequest("GET",a,null,b,c)},POST:function(a,b,c){Velveto.ajax.sendRequest("POST",a.url||a,a.data||null,b,c)},executeScript:function(url,callback){Velveto.ajax.GET(url,function(script){eval(script),"function"==typeof callback&&callback()})}},Velveto.session={get:function(a){return localStorage?localStorage.getItem(a+"@"+Velveto.getBaseURL())||"":"undefined"==typeof Velveto.tmp?"":Velveto.tmp[a]||""},set:function(a,b){localStorage?localStorage.setItem(a+"@"+Velveto.getBaseURL(),b):("undefined"==typeof Velveto.tmp&&(Velveto.tmp=[]),Velveto.tmp[a]=b)},remove:function(a){localStorage?localStorage.removeItem(a+"@"+Velveto.getBaseURL()):"undefined"!=typeof Velveto.tmp&&delete Velveto.tmp[a]}},Velveto.extend=function(a,b){var d,c={};for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=b[d]);return c},Velveto.importDocument=function(url,container,callback){Velveto.fireEvent(container,"unload");var loading=container.getAttribute("data-loading-indicator")||Velveto.options.loading_indicator;container.innerHTML=loading,Velveto.fireEvent(container,"beforeLoad"),Velveto.ajax.GET(url,function(html){container.innerHTML=html;var hook=function(){var b,c,a=document.getElementsByTagName("a");for(b=0;b<a.length;b+=1)a[b].href.indexOf(Velveto.getBaseURL())>-1&&a[b].href.indexOf("#!")>-1&&"true"!==a[b].getAttribute("data-ajax")&&a[b].addEventListener("click",function(a){a.stopPropagation(),a.preventDefault(),this.setAttribute("data-ajax","true");var b=JSON.stringify(Velveto.getPathData(window.location.hash)),c=JSON.stringify(Velveto.getPathData(this.href));return b!==c&&Velveto.go(this.href),!1}),a[b].href.indexOf("#!")<0&&a[b].href.indexOf("#")>-1&&"false"!==a[b].getAttribute("data-smooth")&&a[b].addEventListener("click",function(a){if(a.preventDefault(),c=this.href.split("#").pop(),""!==c){this.setAttribute("data-smooth","true");var b=document.getElementById(c);Velveto.scrollTo(b)}return!1});history!==!1&&pushHistory(),"function"==typeof callback&&callback(),Velveto.fireEvent(container,"loaded")},scripts=container.getElementsByTagName("script"),i=0,executeScript;scripts.length>0?(executeScript=function(script){if("undefined"!=typeof script){var next_yet=!1;script.innerHTML&&eval(script.innerHTML),script.src&&(next_yet=!0,Velveto.ajax.executeScript(script.src,function(){i+=1,executeScript(scripts[i])})),next_yet||(i+=1,executeScript(scripts[i]))}else Velveto.fireEvent(container,"scriptLoaded"),hook()},Velveto.fireEvent(container,"beforeScriptLoad"),executeScript(scripts[i])):(Velveto.fireEvent(container,"beforeLoadScript"),Velveto.fireEvent(container,"afterLoadScript"),hook())},function(){Velveto.options.debug&&console.error("ERROR - fail to import document. URL: "+url+" was not found."),Velveto.fireEvent(container,"loadFail")})},Velveto.iObject=function(a,b,c){var d=function(){return JSON.parse(JSON.stringify(a))},e=function(a,b){for(b=b.replace(/\[(\w+)\]/g,".$1").split(".");b.length>0;)a=a[b.shift()];return a},f=function(a,b,c){var e=d(a),f=function(a,b,c){c||(c=e);var d=a.replace(/\[(\w+)\]/g,".$1").split(/\./);d.length<2?c[d[0]]=b:(c[d[0]]||(c[d[0]]={}),c=c[d.shift()],f(d.join("."),b,c))};return f(b,c),e};return void 0===c?e(a,b):void 0===b?d(a):f(a,b,c)},Velveto.template=function(a,b){"array"==typeof b&&(b=b.reduce(function(a,b,c){return a[c]=b,a},{}));var d,c="";return"string"==typeof a&&(c=a),1===a.nodeType&&(c=a.innerHTML),d=(c.match(/\{\{(.*?)\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")})||[],d.map(function(a){c=c.replace(new RegExp("{{"+a+"}}","g"),Velveto.iObject(b,a))}),"string"==typeof a?c:void(1===a.nodeType&&(a.innerHTML=c))},load=function(a,b){Velveto.ajax.abortAll(),setTimeout(function(){var b=document.getElementById(Velveto.options.container_id);b?Velveto.importDocument(Velveto.options.html_directory+a+".html",b):Velveto.options.debug&&console.error("ERROR - Element with id = "+Velveto.options.container_id+" is not found.")},10)},pushHistory=function(){var a=Velveto.history();0!==a.length&&a[a.length-1]===window.location.hash||(a.length>=Velveto.options.history_max&&(a=a.slice((Velveto.options.history_max-1)*-1)),a.push(window.location.hash),Velveto.session.set("Velveto",a.join(" || ")))},Velveto.fireEvent=function(a,b){var c;document.createEventNodeList?(c=document.createEventNodeList(),a.fireEvent(b,c)):(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),a.dispatchEvent(c))},Velveto.back=function(){if(Velveto.isBackable()){var a=Velveto.history();a.pop(),Velveto.go(a.pop()),Velveto.session.set("Velveto",a.join(" || "))}},Velveto.goBackOrGoHome=function(){Velveto.isBackable()?Velveto.back():Velveto.go(Velveto.options.home)},Velveto.goBackOrGoTo=function(a){Velveto.isBackable()?Velveto.back():Velveto.go(a)},Velveto.clearHistory=function(){Velveto.session.set("Velveto","")},Velveto.getBaseURL=function(){return window.location.origin+window.location.pathname},Velveto.getPath=function(){return window.location.hash.replace("#!","")},Velveto.getPathData=function(a){var c,e,f,b={},d={};if(a||(a=window.location.hash),a=decodeURI(a.replace(Velveto.getBaseURL(),"").replace("#!","")),a.indexOf("?")>-1?(a=a.split("?"),b.path=a[0],b.params=a[1]):(b.path=a,b.params=""),a=b.path,"/"===a.charAt(0)&&(a=a.substring(1)),"/"===a.charAt(a.length-1)&&(a=a.slice(0,-1)),b.dir=a.split("/"),"/"!==b.path.charAt(0)&&(b.path="/"+b.path),b.path.indexOf(".")===-1?"/"!==b.path.charAt(b.path.length-1)&&(b.path+="/"):"/"===b.path.charAt(b.path.length-1)&&(b.path=b.path.slice(0,-1)),""===b.params)b.params={};else{c=b.params.split("&");for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&(c[f].indexOf("=")===-1?d[c[f]]="":(e=c[f].split("="),d[e[0]]=e[1]));b.params=d}return b},Velveto.data=function(a){var e,b=Velveto.getPathData(a),c=b.params,d=b.dir;d.shift();for(e in d)Object.prototype.hasOwnProperty.call(d,e)&&(c[e]=d[e]);return c},Velveto.go=function(a,b,c){var d=this.getPathData(a);c!==!1&&this.setPathData(d.dir,d.params),load(d.dir[0],b)},Velveto.goTo=Velveto.go,Velveto.history=function(){return Velveto.session.get("Velveto")?Velveto.session.get("Velveto").split(" || "):[]},Velveto.isBackable=function(){return Velveto.history().length>2},Velveto.refresh=function(){Velveto.go(window.location.hash,!1,!1)},Velveto.scrollTo=function(a,b){if(null!==a&&"number"==typeof a.offsetTop){void 0===b&&(b=250),a=a.offsetTop;var c=(new Date).getTime(),d=window.scrollY,e=setInterval(function(){var f=Math.min(1,((new Date).getTime()-c)/b);document.body.scrollTop=d+f*(a-d),1===f&&clearInterval(e)},25);document.body.scrollTop=d}},Velveto.setPathData=function(a,b){var f,c="?",d="",e="";if(a&&(d="/"+a.join("/"),d.indexOf(".")===-1&&(d+="/")),b)for(f in b)Object.prototype.hasOwnProperty.call(b,f)&&(c+=b[f]?f+"="+b[f]+"&":f+"&");c=c.slice(0,-1),d&&"//"!==d||(d="",c=c.substring(1)),e="#!"+d+c,window.location.hash+"/"===e?history.replaceState(Velveto.getBaseURL(),"",Velveto.getBaseURL()+e):history.pushState(Velveto.getBaseURL(),"",Velveto.getBaseURL()+e)},Velveto.init=function(a){if(Velveto.initialized)Velveto.options.debug&&console.warn("NOTICE - Velveto is already initiated.");else{if(Velveto.initialized=!0,Velveto.options=Velveto.extend(Velveto.options,a||{}),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),""===window.location.hash){var b=window.location.href.replace(Velveto.getBaseURL(),"");Velveto.go(Velveto.options.home+b)}else Velveto.go(window.location.hash);window.addEventListener("hashchange",function(a){Velveto.go(window.location.hash)})}}}(window);