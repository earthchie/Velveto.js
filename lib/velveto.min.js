!function(window){"use strict";var Velveto=window.Velveto||{},load,pushHistory;window.Velveto=Velveto,Velveto.initialized=!1,Velveto.options={container_id:"velveto",home:"home",html_directory:"app/",debug:!1,loading_indicator:"Loading..."},Velveto.ajax={x:[],abortAll:function(){var e;for(e in Velveto.ajax.x)Object.prototype.hasOwnProperty.call(Velveto.ajax.x,e)&&Velveto.ajax.x[e].abort()},xhr:function(){var e;for(e=0;4>e;e+=1)try{return e?new ActiveXObject(["","Msxml2","Msxml3","Microsoft"][e]+".XMLHTTP"):new XMLHttpRequest}catch(t){}},sendRequest:function(e,t,o,n,i){o=o||null;var a,r=new Velveto.ajax.xhr,l="";if("object"==typeof o){for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(l+="&"+a+"="+o[a]);o=l.substring(1)}r.onreadystatechange=function(){if(4===r.readyState){var e;for(e in Velveto.ajax.x)if(Velveto.ajax.x[e]===r){Velveto.ajax.x.splice(e,1);break}200===r.status?"function"==typeof n&&n(r.responseText):"function"==typeof i&&i(r)}},r.open(e.toString().toUpperCase(),t,!0),r.send(o),Velveto.ajax.x.push(r)},GET:function(e,t,o){Velveto.ajax.sendRequest("GET",e,null,t,o)},POST:function(e,t,o){Velveto.ajax.sendRequest("POST",e.url||e,e.data||null,t,o)},executeScript:function(url,callback){Velveto.ajax.GET(url,function(script){eval(script),"function"==typeof callback&&callback()})}},Velveto.session={get:function(e){return localStorage?localStorage.getItem(e)||Velveto.tmp[e]:"undefined"==typeof Velveto.tmp?"":Velveto.tmp[e]||""},set:function(e,t){localStorage?localStorage.setItem(e,t):("undefined"==typeof Velveto.tmp&&(Velveto.tmp={}),Velveto.tmp[e]=t)},remove:function(e){localStorage?localStorage.removeItem(e):"undefined"!=typeof Velveto.tmp&&delete Velveto.tmp[e]}},Velveto.extend=function(e,t){var o,n={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},Velveto.importDocument=function(url,container,callback){Velveto.fireEvent(container,"unload");var loading=container.getAttribute("data-loading-indicator")||Velveto.options.loading_indicator;container.innerHTML=loading,Velveto.fireEvent(container,"beforeLoad"),Velveto.ajax.GET(url,function(html){container.innerHTML=html;var hook=function(){var e,t=document.getElementsByTagName("a");for(e=0;e<t.length;e+=1)t[e].href.indexOf(Velveto.getBaseURL())>-1&&t[e].href.indexOf("#!")>-1&&"true"!==t[e].getAttribute("data-ajax")&&t[e].addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),this.setAttribute("data-ajax","true");var t=JSON.stringify(Velveto.getPathData(window.location.hash)),o=JSON.stringify(Velveto.getPathData(this.href));return t!==o&&Velveto.go(this.href),!1}),t[e].href.indexOf("#!")<0&&t[e].href.indexOf("#")>-1&&"false"!==t[e].getAttribute("data-smooth")&&t[e].addEventListener("click",function(e){e.preventDefault(),this.setAttribute("data-smooth","true");var t=document.getElementById(this.href.split("#").pop());return Velveto.scrollTo(t),!1});history!==!1&&pushHistory(),"function"==typeof callback&&callback(),Velveto.fireEvent(container,"loaded")},scripts=container.getElementsByTagName("script"),i=0,executeScript;scripts.length>0?(executeScript=function(script){if("undefined"!=typeof script){var next_yet=!1;script.innerHTML&&eval(script.innerHTML),script.src&&(next_yet=!0,Velveto.ajax.executeScript(script.src,function(){i+=1,executeScript(scripts[i])})),next_yet||(i+=1,executeScript(scripts[i]))}else Velveto.fireEvent(container,"scriptLoaded"),hook()},Velveto.fireEvent(container,"beforeScriptLoad"),executeScript(scripts[i])):(Velveto.fireEvent(container,"beforeLoadScript"),Velveto.fireEvent(container,"afterLoadScript"),hook())},function(){Velveto.options.debug&&console.error("ERROR - fail to import document. URL: "+url+" was not found."),Velveto.fireEvent(container,"loadFail")})},load=function(e,t){Velveto.ajax.abortAll(),setTimeout(function(){var t=document.getElementById(Velveto.options.container_id);t?Velveto.importDocument(Velveto.options.html_directory+e+".html",t):Velveto.options.debug&&console.error("ERROR - Element with id = "+Velveto.options.container_id+" is not found.")},10)},pushHistory=function(){var e=Velveto.history();(0===e.length||e[e.length-1]!==window.location.hash)&&(e.push(window.location.hash),Velveto.session.set("Velveto",e.join(" || ")))},Velveto.fireEvent=function(e,t){var o;document.createEventNodeList?(o=document.createEventNodeList(),e.fireEvent(t,o)):(o=document.createEvent("HTMLEvents"),o.initEvent(t,!0,!0),e.dispatchEvent(o))},Velveto.back=function(){if(Velveto.isBackable()){var e=Velveto.history();e.pop(),Velveto.go(e.pop()),Velveto.session.set("Velveto",e.join(" || "))}},Velveto.clearHistory=function(){Velveto.session.set("Velveto","")},Velveto.getBaseURL=function(){return window.location.origin+window.location.pathname},Velveto.getPath=function(){return window.location.hash.replace("#!","")},Velveto.getPathData=function(e){var t,o,n,i={},a={};if(e||(e=window.location.hash),e=decodeURI(e.replace(Velveto.getBaseURL(),"").replace("#!","")),e.indexOf("?")>-1?(e=e.split("?"),i.path=e[0],i.params=e[1]):(i.path=e,i.params=""),e=i.path,"/"===e.charAt(0)&&(e=e.substring(1)),"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),i.dir=e.split("/"),"/"!==i.path.charAt(0)&&(i.path="/"+i.path),-1===i.path.indexOf(".")?"/"!==i.path.charAt(i.path.length-1)&&(i.path+="/"):"/"===i.path.charAt(i.path.length-1)&&(i.path=i.path.slice(0,-1)),""===i.params)i.params={};else{t=i.params.split("&");for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(-1===t[n].indexOf("=")?a[t[n]]="":(o=t[n].split("="),a[o[0]]=o[1]));i.params=a}return i},Velveto.data=function(e){var t,o=Velveto.getPathData(e),n=o.params,i=o.dir;i.shift();for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t]);return n},Velveto.go=function(e,t,o){var n=this.getPathData(e);o!==!1&&this.setPathData(n.dir,n.params),load(n.dir[0],t)},Velveto.goTo=Velveto.go,Velveto.history=function(){return Velveto.session.get("Velveto")?Velveto.session.get("Velveto").split(" || "):[]},Velveto.isBackable=function(){return Velveto.history().length>2},Velveto.refresh=function(){Velveto.go(window.location.hash,!1,!1)},Velveto.scrollTo=function(e,t){if("object"==typeof e&&"number"==typeof e.offsetTop){t=t||250,e=e.offsetTop;var o=(new Date).getTime(),n=window.scrollY,i=setInterval(function(){var a=Math.min(1,((new Date).getTime()-o)/t);document.body.scrollTop=n+a*(e-n),1===a&&clearInterval(i)},25);document.body.scrollTop=n}},Velveto.setPathData=function(e,t){var o,n="?",i="",a="";if(e&&(i="/"+e.join("/"),-1===i.indexOf(".")&&(i+="/")),t)for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n+=t[o]?o+"="+t[o]+"&":o+"&");n=n.slice(0,-1),i&&"//"!==i||(i="",n=n.substring(1)),a="#!"+i+n,window.location.hash+"/"===a?history.replaceState(Velveto.getBaseURL(),"",Velveto.getBaseURL()+a):history.pushState(Velveto.getBaseURL(),"",Velveto.getBaseURL()+a)},Velveto.init=function(e){Velveto.initialized?Velveto.options.debug&&console.warn("NOTICE - Velveto is already initiated."):(Velveto.initialized=!0,Velveto.options=Velveto.extend(Velveto.options,e||{}),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),""===window.location.hash?Velveto.go(Velveto.options.home):Velveto.go(window.location.hash),window.addEventListener("hashchange",function(e){Velveto.go(window.location.hash)}))}}(window);