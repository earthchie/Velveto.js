/**
 * @name velveto.js
 * @version 2.0.2
 * @update September 20, 2014
 * @website http://velveto.project.in.th/
 * @repo https://github.com/earthchie/Velveto.js
 * @author Earthchie http://www.earthchie.com/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
var Velveto=new function(){var session=new function(){this.get=function(t){return localStorage?localStorage.getItem(t)||"":""},this.set=function(t,e){localStorage&&localStorage.setItem(t,e)}},ajax=new function(){var xhr=[];this.abortAll=function(){for(var t in xhr)xhr[t].abort()},this.x=function(){for(a=0;4>a;a++)try{return a?new ActiveXObject([,"Msxml2","Msxml3","Microsoft"][a]+".XMLHTTP"):new XMLHttpRequest}catch(t){}},this.get=function(t,e,i){var n=new this.x;n.open("GET",t,!0),n.send(),n.onreadystatechange=function(){if(4==n.readyState){for(var t in xhr)if(xhr[t]==n){xhr.splice(t,1);break}200==n.status?"function"==typeof e&&e(n.responseText):"function"==typeof i&&i(n)}},xhr.push(n)},this.getScript=function(url){this.get(url,function(r){eval(r)})}},fireEvent=function(t,e){if(document.createEventNodeList){var i=document.createEventNodeList();t.fireEvent(e,i)}else{var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),t.dispatchEvent(i)}},load=function(filename,history){ajax.abortAll();var _this=this;setTimeout(function(){var body=document.getElementById("velveto");if(body){var loading=body.getAttribute("data-loading-indicator");null!=loading&&"false"!=loading&&"0"!=loading&&(body.innerHTML=loading),fireEvent(document.getElementById("velveto"),"beforeLoad"),ajax.get("app/"+filename+".html",function(r){body.innerHTML=r;var scripts=document.querySelectorAll("#velveto script");for(var i in scripts)scripts[i].innerHTML&&eval(scripts[i].innerHTML),scripts[i].src&&ajax.getScript(scripts[i].src);for(var a=document.getElementsByTagName("a"),i=0;i<a.length;i++)a[i].href.indexOf(_this.Velveto.getBaseURL())>-1&&a[i].href.indexOf("#!")>-1&&null===a[i].getAttribute("data-ajax")&&(a[i].setAttribute("data-ajax","true"),a[i].addEventListener("click",function(t){t.stopPropagation(),t.preventDefault();var e=JSON.stringify(_this.Velveto.getPathData(window.location.hash)),i=JSON.stringify(_this.Velveto.getPathData(this.href));return e!=i&&_this.Velveto.goTo(this.href),!1})),a[i].href.indexOf("#!")<0&&a[i].href.indexOf("#")>-1&&null===a[i].getAttribute("data-smooth")&&(a[i].setAttribute("data-smooth","true"),a[i].addEventListener("click",function(t){t.preventDefault();var e=document.getElementById(this.href.split("#").pop());return _this.Velveto.scroll(e),!1}));fireEvent(document.getElementById("velveto"),"loaded"),history!==!1&&pushHistory()},function(){fireEvent(document.getElementById("velveto"),"loadFail")})}else console.error("Error - Element with id = velveto is not found.")},10)},pushHistory=function(){var t=this.Velveto.history();(0==t.length||t[t.length-1]!=window.location.hash)&&(t.push(window.location.hash),session.set("Velveto",t.join(" || ")))};this.back=function(){if(this.isBackable()){var t=this.history();t.pop(),this.goTo(t.pop()),session.set("Velveto",t.join(" || "))}},this.clearHistory=function(){session.set("Velveto","")},this.getBaseURL=function(){return window.location.origin+window.location.pathname},this.getPath=function(){return window.location.hash.replace("#!","")},this.getPathData=function(t){var e=!1,i={};if(t||(e=!0,t=window.location.hash),t=decodeURI(t.replace(this.getBaseURL(),"").replace("#!","")),t.indexOf("?")>-1?(t=t.split("?"),i.path=t[0],i.params=t[1]):(i.path=t,i.params=""),t=i.path,"/"==t.charAt(0)&&(t=t.substring(1)),"/"==t.charAt(t.length-1)&&(t=t.slice(0,-1)),i.dir=t.split("/"),"/"!=i.path.charAt(0)&&(i.path="/"+i.path),-1==i.path.indexOf(".")?"/"!=i.path.charAt(i.path.length-1)&&(i.path+="/"):"/"==i.path.charAt(i.path.length-1)&&(i.path=i.path.slice(0,-1)),""!=i.params){var n=i.params.split("&"),o={};for(var a in n)if(-1==n[a].indexOf("="))o[n[a]]="";else{var s=n[a].split("=");o[s[0]]=s[1]}i.params=o}return e&&this.setPathData(i.dir,i.params),i},this.goTo=function(t,e,i){var n=this.getPathData(t);i!==!1&&this.setPathData(n.dir,n.params),load(n.dir[0],e)},this.history=function(){return session.get("Velveto")?session.get("Velveto").split(" || "):[]},this.isBackable=function(){return this.history().length>2},this.refresh=function(){this.goTo(window.location.hash,!1,!1)},this.scroll=function(t){function e(t,e,i,n,o,a,s){if(t){var r=(new Date).getTime(),h=setInterval(function(){var l=Math.min(1,((new Date).getTime()-r)/a);s?t[e]=n+l*(o-n)+i:t.style[e]=n+l*(o-n)+i,1==l&&clearInterval(h)},25);t.style[e]=n+i}}t&&e(document.body,"scrollTop","",window.scrollY,t.offsetTop,250,!0)},this.setPathData=function(t,e){var i="?",n="";if(t&&(n="/"+t.join("/"),-1==n.indexOf(".")&&(n+="/")),e)for(var o in e)i+=e[o]?o+"="+e[o]+"&":o+"&";i=i.slice(0,-1),n&&"//"!=n||(n="",i=i.substring(1)),history.pushState(this.getBaseURL(),"",this.getBaseURL()+"#!"+n+i)},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),""==window.location.hash?this.goTo("home"):this.goTo(window.location.hash);var _this=this;window.addEventListener("hashchange",function(){_this.goTo(window.location.hash)})};
//# sourceMappingURL=velveto.min.js.map